<!DOCTYPE html>
<html>
<!-- vim: shiftwidth=4 tabstop=4 noexpandtab paste  background=dark
-->
<!-- covidtracking_care_capacity_map.html 
	cuz this version have case data from covidtracking
	future may use diff source and may need diff field names for the choropleth 
	This version use data from AlgB, data in state+capacity+cases.geojson

	ref: 
	http://bl.ocks.org/danswick/d813345baf286a5e0766c6b3d9de01c0
	https://gist.github.com/danswick/d813345baf286a5e0766c6b3d9de01c0

	tin (at) berkeley.edu  2020.04.21
	- trying new calculcated column BedUtil
    - need to filter the null data, also filter by desired date.
-->

<!-- orig from nyc collision tutorial -->
<!-- mapbox tutorial multi-date data in .geojson: https://docs.mapbox.com/help/tutorials/show-changes-over-time/ , 
  with local test as: https://tin6150.github.io/covid19_care_capacity_map/eg_nyc_collision_map.html 
-->
<head>
  <meta charset='utf-8' />
  <title>COVID19 Hospital bed capacity vs utilization</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />

  <script src="https://d3js.org/d3.v4.min.js"></script><!-- for date slider in cb4event_dateSlider -->


  <style type="text/css">

/* // # is not comment in css, probably cuz how html/url need to use # ...  */
/* and the snafu was cuz i had the above comment using // and presumably caused a parse error and ignored the block below.  *sigh* */
/* css validador would likely have been able to point that out and saved me hours of time!! */

body {
    margin: 0;
    padding: 0;
}

h2, h3 {
    margin: 10px;
    font-size: 1.2em;
}

h3 {
    font-size: 1em;
}


p {
    font-size: 0.85em;
    margin: 10px;
    text-align: left;
}


/**
* Create a position for the map on the html page
* currently occupy the whole page */
#map {
	position: absolute;
	top: 0;
	bottom: 0;
	width: 80%; /* should be 100 when not dbg */
}



/**
* Set rules for how the map overlays
* (info box and legend) will be displayed
* on the page. */
/* white small box top right TR */
.map-overlay {
	position: absolute;
	bottom: 0;
	right: 0;
	background: rgba(250, 250, 250, 0.8);  /* 255 255 255 is pure white */
	margin-right: 4px; /* choropleth used 20px */
	font-family: Arial, sans-serif;
	overflow: auto;
	border-radius: 3px;
}
/* this specify the size of the top right info box TR */
#features {
    top: 0;
    height: 190px;      /* formerly 190px */
    margin-top: 10px;
    width: 250px;      /* formerly 250px */
}


/* yellowish box bottom right BR */
.map-overlay-dbg {
  position: absolute;
  bottom: 0;  
  right: 0;
  background: rgba(250, 250, 224, 0.8);  /* this is greenish/yellowish */ 
  margin-right: 4px; /* choropleth used 20px */
  margin-bottom: 16px; /* leave some space for copyright/attribution */
  font-family: Arial, sans-serif;
  overflow: auto;
  border-radius: 3px;
}
/* debug box, BR, yellow-ish, may need it bigger than 600 x 400 */
#featuresDbg {
    /*top: 110; */
    margin-top: 20px;
    height: 360px;      /* formerly 100px */
    width:  500px;      /* formerly 250px */
    font-family:"avenir next", Arial, sans-serif;
    font-size: 12px;
}




/* cyan-ish box bottom left BL */
.map-overlay-dbg2 {
  position: absolute;
  bottom: 0;  
  left: 0;
  background: rgba(106, 221, 236, 0.8);  /* this is cyain-ish */ 
  margin-left: 4px; /* choropleth used 20px */
  margin-bottom: 16px; /* 28px needed for mapbox logo */
  font-family: Arial, sans-serif;
  overflow: auto;
  border-radius: 3px;
}

/* debug box2 BL, cyain-ish, may need it bigger than 600 x 400 */
#featuresDbg2 {
    /*top: 110; */
    /*margin-top: 20px; */
    height: 360px;   
    width:  500px;    
    font-family:"avenir next", Arial, sans-serif;
    font-size: 12px;
}


/** "console" : nyc collision example, where User Control is presented - Top Left TL **/
#console {
  position: absolute;
  width: 240px;
  margin: 10px;
  padding: 10px 20px;
  background-color: white;
}

/** legend is from the nyc collision example, mostly fitted INSIDE TL "console"  **/

#legend {
  padding: 10px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  line-height: 18px;
  height: 150px;
  margin-bottom: 40px;
  width: 100px;
}

.legend-key {
  display: inline-block;
  border-radius: 20%;
  width: 10px;
  height: 10px;
  margin-right: 5px;
}


/** colorbar gradient in legend is generated by this css **/
.colors {
  /*background: linear-gradient(to right, #2dc4b2, #3bb3c3, #669ec4, #8b88b6, #a2719b, #aa5e79); nyc scale*/
  background: linear-gradient(to right, #ffffcc,#ffeda0,#fed976,#feb24c,#fd8d3c,#fc4e2a,#e31a1c,#bd0026,#800026 );    /*covid19*/
  margin-bottom: 5px;
}
/** row to force the colorbar to be in a narrow height of 12 pixels **/
.row {
  height: 12px;
  width: 100%;
}
/** the label css is for the text legend below the colorbar to be horizontal (def to vertical) **/
.label {
  width: 20%;   /*nyc collision had 6 entries for 'lable' which came out to 6*15=90%*/
  display: inline-block;
  text-align: center;
}
.session__noNeed {
  margin-bottom: 20px;
}

/************************************************************************/
/* date slider via D3 */

/* this specify the size of the top right info box TR */
#d3dateSliderOverlay {
	position: absolute ;
    bottom: 0;
    height: 60px;      /* formerly 190px */
    width: 600px;      /* formerly 250px */
    margin-bottom: 18px;
  	background-color: pink;
}

d3DateSliderBody {
      font-family:"avenir next", Arial, sans-serif;
      font-size: 12px;
      color: #696969;
}

.ticks {
	font-size: 10px;
}

.track,
.track-inset,
.track-overlay {
	stroke-linecap: round;
}

.track {
	stroke: #000;
	stroke-opacity: 0.3;
	stroke-width: 10px;
}

.track-inset {
	stroke: #ddd;
	stroke-width: 8px;
}

.track-overlay {
	pointer-events: stroke;
	stroke-width: 50px;
	stroke: transparent;
	cursor: crosshair;
}

.handle {
	fill: #fff;
	stroke: #000;
	stroke-opacity: 0.5;
	stroke-width: 1.25px;
}

</style>
</head>


<!--
-->



<body>

<div id='map'></div>


<!-- this create the top right info box -->
<div class='map-overlay' id='features'>
	<h2>Hospital Utilization</h2> <!-- this is title of top right box -->
	<div id='pd'><p>Hover to show capacity data.</p></div>   <!-- static text, replaced later by JS -->
</div>

<!-- funny positioning by mapbox gl js?  it goes in the bottom right without obvious place where this is specified -->
<div class='map-overlay-dbg' id='featuresDbg'><!-- BR yellowish box -->
	<div id='dbgBox'><p>(data via mapbox tileset)</p></div>   <!-- static text, replaced later by JS -->
</div>
<div class='map-overlay-dbg2' id='featuresDbg2'><!-- BL cyanish box-->
	<div id='dbgBox2'><p>(dbg for queried data via)</p></div>   <!-- static text, replaced later by JS -->
</div>


<!-- nyc collision eg, top left user input "console" -->
<div id='console'>

  <!-- date slider via d3, mostly controlled by cb4event_dateSlider and a bunch of global *dateSlider* var , quite annoying with its placement req, cuz d3 just draw in a specific unexpected way-->
  <!-- augh, this d3 is not usable, use absolute pixel drawing, dont resize according to scren :/ -->
  <div class="d3DateSliderOverlay" id="d3slider">[-d3 dateSlider-]</div>

  <h4>COVID19 Hospital bed utilization</h4>
  <p></p>
  <!-- drop down picker selection UI -->
  <!--<div class='dataClassPicker'> <!-- formerly 
      -->
  <div class='session'> 
      <select id="dataClassSelectorUI">
          <option value="Positive" >Positive cases</option> 
          <option value="BedUtil"  >Hospital Bed Utilization</option> 
          <option value="ICU" disabled >ICU cases</option> 
      </select>
  </div>

	<!-- this is all that is needed to create a legend colorbar, no scripting req.
		just html element!  well, actually, the css "row colors" is actually doing the color grading.    
	originally in tutorial this is in the "console" collision UI box.  i just put it here for emphasis :P -->
	<div class='session'>
		<h4>Hosp Bed Util %</h4>
		<div class='row colors'>
		</div>
		<div class='row labels'>
		  <div class='label'>N/A</div>
		  <div class='label'>0%</div>
		  <div class='label'>50%</div>
		  <div class='label'>100%+</div>
		</div>
	</div>

 	<!-- slider control UI -->
	<div class='session' id='sliderbar'>
	  <h2>Date: <label id='active-date'>4/19</label></h2>
	  <input id='slider' class='row' type='range' min='20200307' max='20200419' step='1' value='20200419' />
	</div>
	

</div> <!-- end div console -->

	

<script>

// slider for date, using S3 - ref: https://bl.ocks.org/officeofjane/b3f6a4f89a54fb193265b5c05659e17b
// mostly used by cb4event_dateSlider()
var formatDateIntoYear = d3.timeFormat("%Y");
var formatDate = d3.timeFormat("%b %Y");
var startDate = new Date("2020-03-07"),
    endDate = new Date("2020-04-20");
var dateSliderMargin;
var dateSliderSvg;
var dateSliderX;
var d3dateSlider;
var d3handle;
var d3dateSliderLabel;
// end of var declaration for d3 date slider

// define access token
//mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2lqbmpqazdlMDBsdnRva284cWd3bm11byJ9.V6Hg2oYJwMAxeoR9GEzkAA'; // census choropleth tutorial
mapboxgl.accessToken = 'pk.eyJ1IjoidGluMTE3IiwiYSI6ImNrNWxnd21ydjBvc2UzZG8wanQzaGwzcGIifQ.3_B2PYgav56oacPlVu5u9w';  // tin117 for nyc/covid19
// above was presented by Studio Beta 2020.0412, for covid19-Monochrome (under tin117)
// mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2lqbmpqazdlMDBsdnRva284cWd3bm11byJ9.V6Hg2oYJwMAxeoR9GEzkAA';  
// above is from tutorial solution
// below is from my Mapbox Studio I think... 
// mapboxgl.accessToken = 'pk.eyJ1Ijoic241MCIsImEiOiJjam8weWl0dm0wNWVhM3dubmgyb3hwaTZsIn0.2Cvl-nnhZAoavESou_RqiQ';


// const map = new mapboxgl.Map({ 
console.log("--dbg--L242: right before new mapboxgl.Map(...)" );
var map = new mapboxgl.Map({
    container: 'map', // container id
    //style: 'mapbox://styles/examples/cjgioozof002u2sr5k7t14dim', // map style URL from Mapbox Studio // census choropleth tutorial
    style: 'mapbox://styles/tin117/ck8xway380ojo1isg3z408rc9',   // covid19-monochrome  2020-0412

    attributionControl: false,                  // if setting to false remove the fine print at bottom.  I still have an info circle that pop up, should be good enough
    //hash: true,     // change URL with a hash of map zoom/lat/long    eg append: #15/37.434/-121.945   # notice it is lat/long in this url!!  so it is zoom/y/x


    //minZoom: 2,  // studio have census track data avail in zoom 10 to 22, trying to see if can have data show up with much less detail (ie lower zoom num)
                   // nope, minZoom here can't overwrite studio data limit.
    //maxZoom:15,  // avoid over zooming in, since this is for state level data

    zoom: 3.7,
    center: [-88.4, 42.8], // initial map center in [lon, lat] (whole US)
    //zoom: 12,
    //center: [-74.0059, 40.7128], // initial map center in [lon, lat] (NYC)
    //center: [-122.447303, 37.753574]   SF
    //center: [-121.945, 37.434],  // alviso ZWEDC
});


// this update the TL overlay data box named feature in the html div
function cb4mouseMove_featuresDataBoxInfo(e) {
        //console.log( "--trc-- L319: inside cb4mouseMove_featuresDataBoxInfo(...)" );
        var states = map.queryRenderedFeatures(e.point, {
            //layers: ['egPropertySingle-x3']
            layers: ['cap+case']     // this has to match name in addLayer id
            //layers: ['states']
            //layers: ['covid19-bedUtil']
        });
        text2display = "no data yet";
        dbgText2display = "no data yet";
        dbgText2display = JSON.stringify(states);  //tmp dbg use
        dbg2Text2display = "no data yet";

        if (states.length > 0) {
            text2display = 
               "Location: "         + states[0].properties.Location + "<BR>" 
             + "Hosp Bed Util: "    + states[0].properties.BedUtil + "<BR>" 
             + "Bed Per 1000 pop: " + states[0].properties.HospitalBedsPer1kPop + "<br>" 
             + "positive cases: "   + states[0].properties.positive + "<br>" ;

            dbgText2display = JSON.stringify(states);  //tmp dbg use
            dbg2Text2display = JSON.stringify(states[0]);  //tmp dbg use
        } else {
            text2display += '<p>Hooover...</p>';
        };
        document.getElementById('pd').innerHTML = text2display;           // pd is inside TR overlay box
        document.getElementById('dbgBox2').innerHTML  = dbgText2display;   // dbgBox  is BR overlay box dbg    // why cant use dbgBox ? complain is null...
        document.getElementById('dbgBox2').innerHTML = dbg2Text2display;  // dbgBox2 is BL overlay box dbg2
};  //end cb4mouseMove_featuresDataBoxInfo()


// this callback to handle mousemove should work now
function cb4mouseMove_dbgBoxInfo(e) {
        //console.log( "--trc-- L344: inside cb4mouseMove_dbgBoxInfo(...)" );
        var states = map.queryRenderedFeatures(e.point, {
            layers: ['egPropertySingle-x3']
            //layers: ['delaware-tabblock2010-10-pophu-a0nmlv'] // this is 403 forbidden on 2020.0412
            //layers: ['tabblock2010_10_pophu']
            //layers: ['delaware']   // didn't work
            //layers: ['statedata']  // from cholopleth tutorial, not sure what this name match to :/
        });
        var features = map.queryRenderedFeatures(e.point);
        document.getElementById('featuresDbg').innerHTML = JSON.stringify(features, null, 2);
};  // end cb4mouseMove_dbgBoxInfo()


// xref: see ZWEDC_50x50sq_js line 218 for map.on('zoom') to change legend scale
// this callback fn handle the date slider event
function cb4event_dateSlider(e) {
    console.log("--trc--L418: inside slider parser cb4event_dateSlider(e) [d3 version]" );

	dateSliderMargin = {top:0, right:50, bottom:0, left:50},
		width = 960 - dateSliderMargin.left - dateSliderMargin.right,
		height = 100 - dateSliderMargin.top - dateSliderMargin.bottom;

	dateSliderSvg = d3.select("#d3slider")
		//.append("dateSliderSvg")
		.append("svg")
		.attr("width", width + dateSliderMargin.left + dateSliderMargin.right)
		.attr("height", height);
		
	dateSliderX = d3.scaleTime()        // x is the user input for desired data date
		.domain([startDate, endDate])
		.range([0, width])
		.clamp(true);

	d3dateSlider = dateSliderSvg.append("g")
		.attr("class", "d3slider")
		.attr("transform", "translate(" + dateSliderMargin.left + "," + height / 2 + ")");

	d3dateSlider.append("line")
		.attr("class", "track")
		.attr("x1", dateSliderX.range()[0])
		.attr("x2", dateSliderX.range()[1])
	.select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
		.attr("class", "track-inset")
	.select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
		.attr("class", "track-overlay")
		.call(d3.drag()
			.on("start.interrupt", function() { d3dateSlider.interrupt(); })
			.on("start drag", function() { cb_redrawDate(dateSliderX.invert(d3.event.x)); }));
			//.on("start drag", function() { hue(x.invert(d3.event.x)); }));

	d3dateSlider.insert("g", ".track-overlay")
		.attr("class", "ticks")
		.attr("transform", "translate(0," + 18 + ")")
	.selectAll("text")
		.data(dateSliderX.ticks(10))
		.enter()
		.append("text")
		.attr("x", dateSliderX)
		.attr("y", 10)
		.attr("text-anchor", "middle")
		.text(function(d) { return formatDateIntoYear(d); });

	d3dateSliderLabel = d3dateSlider.append("text")  
		.attr("class", "label")
		.attr("text-anchor", "middle")
		.text(formatDate(startDate))
		.attr("transform", "translate(0," + (-25) + ")")
	d3handle = d3dateSlider.insert("circle", ".track-overlay")
		.attr("class", "handle")
		.attr("r", 9);


};  //end cb4event_dateSlider()


function cb_redrawDate(h) {
	console.log("--trc--L457: inside cb4_redrawDate" );
	console.log("--dbg--L457: h param passed in is: ", h.toString() );
	d3handle.attr("cx", dateSliderX(h));
	d3dateSliderLabel
		.attr("x", dateSliderX(h))
		.text(formatDate(h));
	dateSliderSvg.style("background-color", d3.hsl(h/1000000000, 0.8, 0.8));
}; // end cb_redrawDate

// this callback fn handle the date slider event
function cb4event_dateSlider_obsolete(e) {
    	console.log("--trc--L344: inside slider parser cb4event_dateSlider(e)" );
		var dateAsNum = parseInt(e.target.value);
		// update the map
		// so mapbox API still used to do the filtering... think of grep for data locally before render
		//map.setFilter('collisions', ['==', ['number', ['get', 'Hour']], hour]);
		map.setFilter('cap+case', ['==', ['number',['get','date']], dateAsNum ]);    // range 20200307 to 20200419 
		//             ^^^1^^^^                      ^2^^^^^^2^^     ^^3^
		// ^1^: the first param for setFilter, match the name of 'id' for map.addLayer(...)
		// ^2^: 'date' is one of the properties in the .geojson
		// ^3^: 'dateAsNum' is read as var from parseInt(e...) 
		
		// converting 2020.0307 to 3/17 format
		var monthDigit = Math.abs( dateAsNum ).toString().substring(4,6);
		var dayDigit   = Math.abs( dateAsNum ).toString().substring(6,8); 
		//var dayDigit2  = Math.abs( dateAsNum ).toString();   // should look for date parser lib   ++FIXME
		console.log("--dbg--L360: dateAsNum : ", dateAsNum );
		console.log("--dbg--L360: monthDigit: ", monthDigit);
		console.log("--dbg--L360: dayDigit  : ", dayDigit );
		//var dayDigit   = Math.toString( dateAsNum ).substring(5,7) ;   // should look for date parser lib   ++FIXME
		// update text in the UI
		//document.getElementById('active-date').innerText = monthDigit + "/" + dayDigit;
		document.getElementById('active-date').innerText = monthDigit + "/" + dayDigit;

}; // end cb4event_dateSlider(e)

function cb4event_dataClassSelectorUI(e) { 
	console.log("--trc--L363: inside cb4event_dataClassSelectorUI(e)" );
	// next filter item by date, using the radius boxes UI.  see section of "Add interactivity" in tutorial
	// there is some bug in updating/querying hour vs day of week input 
	// but that's a problem from the tutorial, i dont need to debug for this eg
	// hopefully does not affect my covid19  map, but there may have to check the setFilter and mousemove events more carefully.
	var day = e.target.value;
	// update the map filter
	if (day === 'all') {
		filterDay = ['!=', ['string', ['get', 'Day']], 'placeholder'];
	} else if (day === 'weekday') {
		filterDay = ['match', ['get', 'Day'], ['Sat', 'Sun'], false, true];
	} else if (day === 'weekend') {
		filterDay = ['match', ['get', 'Day'], ['Sat', 'Sun'], true, false];
	} else {
		console.log('error');
	}
	map.setFilter('collisions', ['all', filterDay]);

}; // end cb4event_dataClassSelectorUI(e) 

// addLayer is where lot of changes from nyc map   ++FIXME++
//map.on('load', function() {
function cb4map_on_load__covidtracking() {
	console.log("--trc--L240: in cb4map_on_load__covidtracking()" );
	map.getCanvas().style.cursor = 'default';
	// https://stackoverflow.com/questions/51166886/how-to-fill-color-for-a-region-based-on-value-in-mapbox
	// caair.html
	//--map.addSource('population', {
	map.addSource('covid19-cap+case', {  // see ZWEDC_50x50sq_js.html line 461
		'type': 'geojson',
		'data': './state+capacity+cases.geojson'
	})

  console.log("--trc--L367: right before map.addLayer" )
	map.addLayer({
		id:   'cap+case',     // id: 'covid19-bedUtil',        //formerly id: 'covidtracking',
		type: 'fill', // 'vector'
		source: 'covid19-cap+case',
		// https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/#interpolate
		paint: {		///* this is the mapbox EXPRESSION api to dynamically change styling (instead of having defined it in mapbox studio as part of the layer)*/
			'fill-color': [
                'interpolate',
                ['linear'],
                //['get', 'positive'],    //tmp use, no null here
                ['get', 'BedUtil'],       // change field here
                // 9 classes, multi-hue from light yellow to dark red.  need to match legend drawn by html/css
                // https://colorbrewer2.org/?type=sequential&scheme=YlOrRd&n=9
                0,    '#ffffff',    // adding white, hopefully null falls in here
                0.1,  '#ffffcc',
                  1,  '#ffeda0',
                  5,  '#fed976',
                10,  '#feb24c',
                30,  '#fd8d3c',
                50,  '#fc4e2a',
                70,  '#e31a1c',
                90,  '#bd0026',
                100,  '#800026'
        	],
		    //'fill-color': [ "curve", ["step"], ["number", ["get", "density"], 1], "#FFEDA0", 10, "#FED976", 20, "#FEB24C", 50, "#FD8D3C", 100, "#FC4E2A", 200, "#E31A1C", 500, "#BD0026", 2000, "#000000" ],
		    // use a curve (http://bl.ocks.org/anandthakker/raw/6d0269825a7e0381cdcde13f84a0b6b0/#types-expression-curve)
		    // of type "step," which will step through each break instead of interpolating between them.
		    // Then, get the density value and use a `number` expression to return it as a number instead of a string.
		    // Each step is then a pair [{color code}, {max value for break}]
		    // Finally, add a default color code for any features that fall outside of the steps you've defined.
		    //-"curve", ["step"], ["number", ["get", "density"], 1], "#FFEDA0", 10, "#FED976", 20, "#FEB24C", 50, "#FD8D3C", 100, "#FC4E2A", 200, "#E31A1C", 500, "#BD0026", 2000, "#000000"
			  'fill-opacity': 0.3
		},
		layout: {}

	});  // end map.addLayer()
	console.log("--trc--L434: after code for map.addLayer()" );

	
	// filter option, first it was static, 
	// then changed to depend on DOM input, see toward end of tutorial in "Add interactivity"
	// trying to add filter for the data , toward end of tutorial in "Add interactivity"
	//map.setFilter('collisions', ['==', ['number', ['get', 'Hour']], 12]);
    //            "filter":   ['==', ['type',  ['get', 'key']],'value']
	map.setFilter('cap+case', ['==', ['number',['get','date']], 20200419 ]);    // range 20200307 to 20200419 
	document.getElementById('slider').addEventListener('input', cb4event_dateSlider );

	document.getElementById('dataClassSelectorUI').addEventListener('change', cb4event_dataClassSelectorUI );

	console.log("--trc--L456: right before map.on('mousemove', cb...) " );
	map.on('mousemove', cb4mouseMove_dbgBoxInfo);
	map.on('mousemove', cb4mouseMove_featuresDataBoxInfo);  //TL overlay

	console.log("--trc--L459: at the end of cb4map_on_load__covidtracking()" );
};  //end cb4map_on_load__covidtracking()


// /////////////////////////////////
// "main" running thead
// /////////////////////////////////

// wait for map to load before adjusting it
console.log("--dbg--L545: right before map.on('load',cb4map_on_load__covid)" );
//~~map.on('load', cb4map_on_load__covid_obsolete)   // see if can read geojson data in dbg box
map.on('load', cb4map_on_load__covidtracking)  // UI input was in this callback fn  
console.log("--dbg--L546: right after map.on('load',cb4map_on_load__covid)" );

map.addControl( new mapboxgl.NavigationControl(), 'top-right');  
map.addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}));

// https://www.mapbox.com/mapbox-gl-js/api/#attributioncontrol
map.addControl(new mapboxgl.AttributionControl({
        compact: false,  // set to false to add an EXTRA line with info below prefixed.  true add an (i) icon
        customAttribution: '<A HREF="https://github.com/tin6150/covid19_care_capacity_map">(cc) Tin  App Info</A>'
}));

// invoke this once to do initial draw of date slider and set proper start date
cb4event_dateSlider(null);

console.log("--dbg--L547: the-end of script section, no more code, but likely exec early cuz of async nature and all the call backs!)" );


// js callbacks tutorial: https://github.com/maxogden/art-of-node#callbacks
</script>
</body>
</html>
